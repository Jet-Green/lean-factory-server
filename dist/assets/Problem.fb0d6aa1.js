import{d as ae,m as ne,w as he,a as oe,u as xe,b as ue,c as x,h as Z,r as g,e as ie,f as se,g as re,i as ce,j as de,k as t,V as fe,l as A,F as _,n as ve,o as me,p as Y,q as W,I as ye,s as Ve,t as Ce,v as U,x as ke,y as we,z as ee,A as Fe,B as Se,C as be,D as Ie,E as K,G as te,H as P,J as Pe,K as j,L as E,M as Q,N as _e,O as Be,P as le,Q as Re,R as X,S as ze,T as De,U as Ae}from"./index.c9c56f3d.js";import{V as Ne,a as Te}from"./VAutocomplete.8839c24b.js";const He=ae({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,hint:String,persistentHint:Boolean,placeholder:String,showSize:{type:[Boolean,Number],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(e)},...ne({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:e=>he(e).every(S=>S!=null&&typeof S=="object")},...oe({clearable:!0})},emits:{"click:control":e=>!0,"update:modelValue":e=>!0},setup(e,S){let{attrs:y,emit:w,slots:o}=S;const{t:r}=xe(),n=ue(e,"modelValue"),m=x(()=>typeof e.showSize!="boolean"?e.showSize:void 0),B=x(()=>{var a;return((a=n.value)!=null?a:[]).reduce((i,d)=>{let{size:V=0}=d;return i+V},0)}),R=x(()=>Z(B.value,m.value)),c=x(()=>{var a;return((a=n.value)!=null?a:[]).map(i=>{const{name:d="",size:V=0}=i;return e.showSize?`${d} (${Z(V,m.value)})`:d})}),s=x(()=>{var d;var a;const i=(d=(a=n.value)==null?void 0:a.length)!=null?d:0;return e.showSize?r(e.counterSizeString,i,R.value):r(e.counterString,i)}),u=g(),p=g(),h=g(!1),f=g(),G=x(()=>e.messages.length?e.messages:e.persistentHint?e.hint:"");function N(){if(f.value!==document.activeElement){var a;(a=f.value)==null||a.focus()}h.value||(h.value=!0)}function T(a){Y(e["onClick:prepend"],a),L(a)}function L(a){var i;(i=f.value)==null||i.click(),w("click:control",a)}function O(a){a.stopPropagation(),N(),W(()=>{n.value=[],f!=null&&f.value&&(f.value.value=""),Y(e["onClick:clear"],a)})}return ie(()=>{const a=!!(o.counter||e.counter),i=!!(a||o.details),[d,V]=re(y),[{modelValue:l,...C}]=ce(e),[k]=de(e);return t(me,A({ref:u,modelValue:n.value,"onUpdate:modelValue":v=>n.value=v,class:"v-file-input","onClick:prepend":T,"onClick:append":e["onClick:append"]},d,C,{focused:h.value,messages:G.value}),{...o,default:v=>{let{isDisabled:b,isDirty:z,isReadonly:H,isValid:I}=v;return t(fe,A({ref:p,"prepend-icon":e.prependIcon,"onClick:control":L,"onClick:clear":O,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},k,{active:z.value||h.value,dirty:z.value,focused:h.value,error:I.value===!1}),{...o,default:D=>{let{props:{class:M,...q}}=D;return t(_,null,[t("input",A({ref:f,type:"file",readonly:H.value,disabled:b.value,multiple:e.multiple,name:e.name,onClick:F=>{F.stopPropagation(),N()},onChange:F=>{var $;if(!F.target)return;const J=F.target;n.value=[...($=J.files)!=null?$:[]]},onFocus:N,onBlur:()=>h.value=!1},q,V),null),t("div",{class:M},[n.value.length>0&&(o.selection?o.selection({fileNames:c.value,totalBytes:B.value,totalBytesReadable:R.value}):e.chips?c.value.map(F=>t(Ne,{key:F,size:"small",color:e.color},{default:()=>[F]})):c.value.join(", "))])])}})},details:i?v=>{var b;return t(_,null,[(b=o.details)==null?void 0:b.call(o,v),a&&t(_,null,[t("span",null,null),t(ve,{active:!!n.value.length,value:s.value},o.counter)])])}:void 0})}),se({},u,p,f)}});const $e=ae({name:"VTextarea",directives:{Intersect:ye},inheritAttrs:!1,props:{autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,hint:String,persistentHint:Boolean,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,...ne(),...oe()},emits:{"click:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,S){let{attrs:y,emit:w,slots:o}=S;const r=ue(e,"modelValue"),{isFocused:n,focus:m,blur:B}=Ve(e),R=x(()=>typeof e.counterValue=="function"?e.counterValue(r.value):(r.value||"").toString().length),c=x(()=>{if(y.maxlength)return y.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function s(l,C){var k,v;!e.autofocus||!l||(k=C[0].target)==null||(v=k.focus)==null||v.call(k)}const u=g(),p=g(),h=g(""),f=g(),G=x(()=>n.value||e.persistentPlaceholder),N=x(()=>e.messages.length?e.messages:G.value||e.persistentHint?e.hint:"");function T(){if(f.value!==document.activeElement){var l;(l=f.value)==null||l.focus()}n.value||m()}function L(l){T(),w("click:control",l)}function O(l){l.stopPropagation(),T(),W(()=>{r.value="",Y(e["onClick:clear"],l)})}function a(l){r.value=l.target.value}const i=g();function d(){!e.autoGrow||W(()=>{if(!i.value||!p.value)return;const l=getComputedStyle(i.value),C=getComputedStyle(p.value.$el),k=parseFloat(l.getPropertyValue("--v-field-padding-top"))+parseFloat(l.getPropertyValue("--v-input-padding-top"))+parseFloat(l.getPropertyValue("--v-field-padding-bottom")),v=i.value.scrollHeight,b=parseFloat(l.lineHeight),z=Math.max(parseFloat(e.rows)*b+k,parseFloat(C.getPropertyValue("--v-input-control-height"))),H=parseFloat(e.maxRows)*b+k||1/0;h.value=we(be(v!=null?v:0,z,H))})}Ce(d),U(r,d),U(()=>e.rows,d),U(()=>e.maxRows,d),U(()=>e.density,d);let V;return U(i,l=>{if(l)V=new ResizeObserver(d),V.observe(i.value);else{var C;(C=V)==null||C.disconnect()}}),ke(()=>{var l;(l=V)==null||l.disconnect()}),ie(()=>{const l=!!(o.counter||e.counter||e.counterValue),C=!!(l||o.details),[k,v]=re(y),[{modelValue:b,...z}]=ce(e),[H]=de(e);return t(me,A({ref:u,modelValue:r.value,"onUpdate:modelValue":I=>r.value=I,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--flush-details":["plain","underlined"].includes(e.variant)}],"onClick:prepend":e["onClick:prepend"],"onClick:append":e["onClick:append"]},k,z,{focused:n.value,messages:N.value}),{...o,default:I=>{let{isDisabled:D,isDirty:M,isReadonly:q,isValid:F}=I;return t(fe,A({ref:p,style:{"--v-textarea-control-height":h.value},"onClick:control":L,"onClick:clear":O,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},H,{active:G.value||M.value,dirty:M.value||e.dirty,focused:n.value,error:F.value===!1}),{...o,default:J=>{let{props:{class:$,...pe}}=J;return t(_,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),ee(t("textarea",A({ref:f,class:$,value:r.value,onInput:a,autofocus:e.autofocus,readonly:q.value,disabled:D.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:T,onBlur:B},pe,v),null),[[Fe("intersect"),{handler:s},null,{once:!0}]]),e.autoGrow&&ee(t("textarea",{class:[$,"v-textarea__sizer"],"onUpdate:modelValue":ge=>r.value=ge,ref:i,readonly:!0,"aria-hidden":"true"},null),[[Se,r.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:C?I=>{var D;return t(_,null,[(D=o.details)==null?void 0:D.call(o,I),l&&t(_,null,[t("span",null,null),t(ve,{active:e.persistentCounter||n.value,value:R.value,max:c.value},o.counter)])])}:void 0})}),se({},u,p,f)}}),Ue=X("h2",null," \u0421\u043E\u043E\u0431\u0449\u0438\u0442\u044C \u043E \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u0435",-1),Ee={style:{"overflow-y":"scroll","max-height":"50px"}},Ge=["src"],je={__name:"Problem",setup(e){const S=x(()=>y.company?y.fetchedPlaces:[]),y=Ie();let w=g(),o=[],r=g([]),n=g(""),m=g();function B(c){if(o.push(c[0]),c=c[0],c){w.value=[];const s=new FileReader;s.readAsDataURL(c),s.addEventListener("load",()=>{r.value.push({name:c.name,img:s.result})},!1)}}async function R(){if(m.value){let c;for(let p of y.fetchedPlaces)p._id==m.value&&(c=p);let s=[];if(o.length){let p=new FormData;for(let f of o)p.append("files",f);let{data:h}=await ze.post("http://localhost:3040/company/upload-problem-photos",p,{headers:{"Content-Type":"multipart/form-data"}});s=h}let u={photos:s,commentToPhoto:n.value,placeId:m.value,actions:[{status:"created",respEmpl:c.empl,date:Date.now()}]};await y.reportProblem(u),n.value="",m.value=null}}return(c,s)=>(K(),te(Pe,null,{default:P(()=>[t(j,{cols:"12"},{default:P(()=>[Ue]),_:1}),t(j,{cols:"12"},{default:P(()=>[t(He,{modelValue:E(w),"onUpdate:modelValue":[s[0]||(s[0]=u=>Q(w)?w.value=u:w=u),B],label:"\u0424\u043E\u0442\u043E",variant:"solo","prepend-icon":"","prepend-inner-icon":"mdi-camera",accept:"image/*"},null,8,["modelValue"]),(K(!0),_e(_,null,Be(E(r),u=>(K(),te(De,{class:"mb-2 pa-2"},{default:P(()=>[X("div",Ee,Ae(u.name),1),X("img",{src:u.img,alt:"",style:{"max-width":"100px"}},null,8,Ge)]),_:2},1024))),256)),t($e,{modelValue:E(n),"onUpdate:modelValue":s[1]||(s[1]=u=>Q(n)?n.value=u:n=u),variant:"solo",rows:"2",counter:"500","auto-grow":"",label:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043A \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u0435"},null,8,["modelValue"])]),_:1}),t(j,{cols:"12"},{default:P(()=>[le(" \u0413\u0434\u0435 \u044D\u0442\u043E \u043F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u043E? "),t(Te,{modelValue:E(m),"onUpdate:modelValue":s[2]||(s[2]=u=>Q(m)?m.value=u:m=u),"hide-no-data":"",variant:"solo",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435",items:E(S),"item-title":"place","item-value":"_id",clearable:""},null,8,["modelValue","items"])]),_:1}),t(j,{cols:"12",class:"d-flex justify-center"},{default:P(()=>[t(Re,{onClick:R},{default:P(()=>[le("\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C")]),_:1})]),_:1})]),_:1}))}};export{je as default};
